# Copyright (c) 2016-present Sven Greb <development@svengreb.de>
# This source code is licensed under the MIT license found in the license file.
# https://github.com/nordtheme/tmux

# Optional:
#  set -g status-right-length 64
#  set -g status-left-length 24


#+----------+
#+ Defaults +
#+----------+
set -ogq @nord-powerline 1
set -ogq @nord-show-datetime 0
set -ogq @nord-warn-tmux-in-ssh 1
set -ogq @nord-warn-multiple-sessions 1
set -ogq @nord-show-prefix-copy-sync 1

set -ogq @nord-bg            default
set -ogq @nord-accent-color  blue
set -ogq @nord-accent-text   black
set -ogq @nord-active-color  cyan
set -ogq @nord-active-text   black
set -ogq @nord-passive-color black
set -ogq @nord-passive-text  white
set -ogq @nord-ssh-color     red
set -ogq @nord-ssh-text      black
set -ogq @nord-wms-color     yellow
set -ogq @nord-wms-text      black
set -ogq @nord-prefix-color  green
set -ogq @nord-prefix-text   black


#+---------+
#+ Options +
#+---------+
set -g status-interval 5
set -g status on


#+-------+
#+ Panes +
#+-------+
set -gF pane-border-style "bg=#{@nord-bg},fg=#{@nord-passive-color}"
set -gF pane-active-border-style "bg=#{@nord-bg},fg=#{@nord-accent-color}"
set -gF display-panes-colour "#{@nord-passive-color}"
set -gF display-panes-active-colour "#{@nord-accent-color}"

#+------------+
#+ Clock Mode +
#+------------+
setw -gF clock-mode-colour "#{@nord-accent-color}"

#+----------+
#+ Messages +
#+---------+
set -gF message-style "bg=#{@nord-bg},fg=#{@nord-accent-color},reverse"
set -gF message-command-style "bg=#{@nord-bg},fg=#{@nord-accent-color},reverse"

#+------------+
#+ Selections +
#+------------+
set -gF mode-style "bg=#{@nord-bg},fg=#{@nord-accent-color},reverse"
set -gF copy-mode-selection-style "bg=#{@nord-passive-color}"
%if "#{>=:#{version},3.4}"
    set -gF menu-selected-style "fg=#{@nord-accent-color}"
%endif


#+--------+
#+ Status +
#+--------+

#+--- Layout ---+
set -g status-justify left

#+--- Colors ---+
set -gF status-style ''
set -gF status-style "bg=#{@nord-bg}"

#+--- Bar Left ---+
set -g status-left ''
set -ag status-left "#[fg=#{@nord-accent-text},bg=#{@nord-accent-color},bold] #S "
%if '#{==:#{@nord-powerline},1}'
    set -ag status-left '#[fg=#{@nord-accent-color},bg=#{@nord-bg},none]'
%endif

#+--- Windows ---+
set -g window-status-format ''
set -g @ws-sep '|'
set -gF @ws-pre-active '#[bg=#{@nord-bg}] '
set -gF @ws-pre-passive '#[bg=#{@nord-bg}] '
set -g @ws-post ''

%if '#{==:#{@nord-powerline},1}'
set -g @ws-sep ''
set -gF @ws-post '#[bg=#{@nord-bg},none]'
%if '#{==:#{@nord-bg},default}'
set -gF @ws-pre-active '#[bg=default,fg=#{@nord-active-color},reverse]'
set -gF @ws-pre-passive '#[bg=default,fg=#{@nord-passive-color},reverse]'
%else
set -gF @ws-pre-active '#[bg=#{@nord-active-color},fg=#{@nord-bg}]'
set -gF @ws-pre-passive '#[bg=#{@nord-passive-color},fg=#{@nord-bg}]'
%endif

set -agF @ws-pre-active '#[none]'
set -agF @ws-pre-passive '#[none]'
%endif

set -g window-status-format '#{@ws-pre-passive}#[fg=#{@nord-passive-text},bg=#{@nord-passive-color}] #I #{@ws-sep} #W #F #[fg=#{@nord-passive-color}]#{@ws-post}'
set -g window-status-current-format '#{@ws-pre-active}#[fg=#{@nord-active-text},bg=#{@nord-active-color}] #I #{@ws-sep} #W #F #[fg=cyan]#{@ws-post}'
set -g window-status-separator ''

#+--- Bar Right ---+
set -g status-right ''

#+--- Prefix Copy Sync ---+
run-shell "tmux set -g @prefix \"\$(
  prefix=\$(tmux show-options -gqv prefix | tr '[:lower:]' '[:upper:]' | sed 's/C-/^/')
  prefix2=\$(tmux show-options -gqv prefix2 | tr '[:lower:]' '[:upper:]' | sed 's/C-/^/')
  if [ \"\$prefix2\" != \"NONE\" ]; then
    echo \"\$prefix/\$prefix2\"
  else
    echo \"\$prefix\"
  fi
)\""
set -gF @pcs-pre '#[fg=#{@nord-prefix-text},bg=#{@nord-prefix-color}]'
set -gF @pcs-post '#[bg=#{@nord-bg}] '
%if '#{==:#{@nord-powerline},1}'
    set -gF @pcs-pre '#[fg=#{@nord-prefix-color},bg=#{@nord-bg}]#[fg=#{@nord-prefix-text}]#[bg=#{@nord-prefix-color}]'
    %if '#{==:#{@nord-bg},default}'
        set -gF @pcs-post '#[bg=default,fg=#{@nord-prefix-color},reverse]'
    %else
        set -gF @pcs-post '#[bg=#{@nord-prefix-color},fg=#{@nord-bg}]'
    %endif
    set -agF @pcs-post '#[none]'
%endif

%if '#{==:#{@nord-show-prefix-copy-sync},1}'
    set -ag status-right \
        '#{?client_prefix,#{@pcs-pre}#{@prefix}#{@pcs-post},#{?pane_in_mode,#{@pcs-pre}Copy#{@pcs-post},#{?synchronize-panes,#{@pcs-pre}Sync#{@pcs-post},}}}'
%endif

#+--- Warm Multiple Sessions ---+
set -gF @wms '#[fg=#{@nord-wms-text},bg=#{@nord-wms-color}] D'
set -gF @wms-post ' #[bg=#{@nord-bg}] '
%if '#{==:#{@nord-powerline},1}'
    set -gF @wms '#[fg=#{@nord-wms-color},bg=#{@nord-bg}]#[fg=#{@nord-wms-text},bg=#{@nord-wms-color}]⇪D'
    %if '#{==:#{@nord-bg},default}'
        set -gF @wms-post '#[bg=default,fg=#{@nord-wms-color},reverse]'
    %else
        set -gF @wms-post '#[bg=#{@nord-wms-color},fg=#{@nord-bg}]'
    %endif
    set -agF @wms-post '#[none]'
%endif
%if '#{==:#{@nord-warn-multiple-sessions},1}'
    set -ag status-right '#{?#{e|>:#{session_attached},1},#{@wms}#{@wms-post},}'
%endif

#+--- dt, host, ssh ---+
set -g @dt-pwl ''
set -g @ssh-pwl ''
set -g @host-pwl-bg ''

#+--- DateTime ---+
set -g @dt-sep '|'
%if '#{==:#{@nord-powerline},1}'
    set -gF @dt-pwl '#[fg=#{@nord-passive-color},bg=#{@nord-bg},none]'
    set -gF @dt-sep ''
%endif

%if '#{==:#{@nord-show-datetime},1}'
    set -ag status-right '#{@dt-pwl}#[fg=#{@nord-passive-text},bg=#{@nord-passive-color}] %Y-%m-%d #{@dt-sep} %H:%M '
    set -gF @host-pwl-bg '#[bg=#{@nord-passive-color}]'
%endif
#+--- Hostname ---+
%if '#{==:#{@nord-powerline},1}'
    set -ag status-right '#[fg=#{@nord-accent-color},none]#{@host-pwl-bg}'
%endif
set -ag status-right '#[fg=#{@nord-accent-text},bg=#{@nord-accent-color},none] #H '

#+--- SSH ---+
set-option -ag update-environment "SSH_CONNECTION"
%if '#{==:#{@nord-powerline},1}'
    set -g @ssh-pwl '#[fg=#{@nord-ssh-color},none]'
%endif

%if '#{==:#{@nord-warn-tmux-in-ssh},1}'
    set -ag status-right "#(if [ \"$(tmux show-environment SSH_CONNECTION 2>/dev/null)\" != \"-SSH_CONNECTION\" ]; then printf '#{@ssh-pwl}#[fg=#{@nord-ssh-text},bg=#{@nord-ssh-color},none] SSH '; fi)"
%endif

