DOTFILES="$HOME/.config/dotfiles"
export DOTFILES

if [ -z "$DOTFILES_PROFILE" ]; then
    DOTFILES_OS="$(uname -s 2>/dev/null | tr 'A-Z' 'a-z')"
    [ -n "$DOTFILES_OS" ] || DOTFILES_OS=unknown
    export DOTFILES_OS

    # exports
    [ -f "$DOTFILES/shell/exports" ] && . "$DOTFILES/shell/exports"
    [ -f "$DOTFILES/shell/exports_$DOTFILES_OS" ] && . "$DOTFILES/shell/exports_$DOTFILES_OS"

    export DOTFILES_PROFILE=1
fi

# editor
[ -f "$DOTFILES/shell/environment" ] && . "$DOTFILES/shell/environment"
[ -f "$DOTFILES/shell/environment_$DOTFILES_OS" ] && . "$DOTFILES/shell/environment_$DOTFILES_OS"

# --- interactive shell setup ---
case "$-" in
    *i*)
        # common definitions
        #echo "common definitions"
        for dotfile in functions aliases; do
            [ -f "$DOTFILES/shell/$dotfile" ] && . "$DOTFILES/shell/$dotfile"
            [ -f "$DOTFILES/shell/${dotfile}_$DOTFILES_OS" ] && . "$DOTFILES/shell/${dotfile}_$DOTFILES_OS"
        done

        # shell specific
        #echo "shell specific"
        _dotfiles_unset_add _dotfiles_is_bash
        _dotfiles_is_bash() {
            [ -n "$BASH_VERSION" ]
        }
        if _dotfiles_is_bash; then
            [ -f "$DOTFILES/bash/bashrc" ] && . "$DOTFILES/bash/bashrc"
        fi

        # os specific
        #echo "os specific"
        [ -f "$DOTFILES/$DOTFILES_OS" ] && . "$DOTFILES/$DOTFILES_OS"

        # utils
        #echo "utils"
        if [ -d "$DOTFILES/utils/" ]; then
            for dotfile in "$DOTFILES"/utils/*; do
                [ -f "$dotfile" ] && . "$dotfile"
            done
        fi

        if _dotfiles_is_bash; then
            # add all aliases completions
            # https://github.com/cykerway/complete-alias
            type _complete_alias >/dev/null 2>&1 && \
              complete -F _complete_alias "${!BASH_ALIASES[@]}"
        fi
        ;;
esac

unset dotfile

# cleaning service functions
if command -v _dotfiles_cleanup >/dev/null 2>&1; then
    _dotfiles_cleanup
fi

