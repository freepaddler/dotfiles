"use strict";const ut=require("@codemirror/state"),t=require("@lezer/highlight"),k=require("markedit-api"),z=require("@codemirror/view"),T=require("@codemirror/language"),S=(e,n={})=>e??n,mt=S(k.MarkEdit.userSettings),R=J("extension.markeditTheming"),ht=M(!1)?S(R.lightTheme):void 0,ft=M(!0)?S(R.darkTheme):void 0;function J(e){return e===void 0?{}:S(mt[e])}function Q(e){return e.enabledMode??"both"}function M(e,n=Q(R)){return["both",e?"dark":"light"].includes(n)}function bt(e,n,c){const a=kt({lhs:c,rhs:e?ft:ht});return{extensions:[...e?A(a,{dark:!0}):A(a),n].filter(o=>o!==void 0),colors:a}}function A(e,n){const c={},a=[],r=e.editor,o=e.highlight;r?.textColor&&(c["&"]??={},c["&"].color=r?.textColor,c[".cm-activeLineGutter"]={backgroundColor:r?.textColor}),r?.backgroundColor&&(c["&"]??={},c["&"].backgroundColor=r?.backgroundColor),r?.activeLineBackground&&(c[".cm-activeLine"]={backgroundColor:r?.activeLineBackground}),r?.caretColor&&(c[".cm-content"]={caretColor:r?.caretColor},c[".cm-cursor, .cm-dropCursor"]={borderLeftColor:r?.caretColor}),r?.selectionBackground&&(c["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:r?.selectionBackground}),r?.matchingBracketBackground&&(c["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:r?.matchingBracketBackground}),r?.gutterText&&(c[".cm-gutters"]??={},c[".cm-gutters"].color=r?.gutterText),r?.gutterBackground&&(c[".cm-gutters"]??={},c[".cm-gutters"].backgroundColor=r?.gutterBackground,c[".cm-gutters"].border="none"),r?.foldPlaceholderText&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].color=r?.foldPlaceholderText),r?.foldPlaceholderBackground&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].backgroundColor=r?.foldPlaceholderBackground,c[".cm-foldPlaceholder"].border="none"),r?.searchMatchBackground&&(c[".cm-searchMatch"]={backgroundColor:r?.searchMatchBackground}),r?.selectionMatchBackground&&(c[".cm-selectionMatch"]={backgroundColor:r?.selectionMatchBackground}),o?.heading&&a.push({tag:t.tags.heading,color:o?.heading}),o?.bold&&a.push({tag:t.tags.strong,color:o?.bold}),o?.italic&&a.push({tag:t.tags.emphasis,color:o?.italic}),o?.strikethrough&&a.push({tag:t.tags.strikethrough,color:o?.strikethrough}),o?.quote&&a.push({tag:t.tags.quote,color:o?.quote}),o?.link&&a.push({tag:[t.tags.url,t.tags.link],color:o?.link}),o?.divider&&a.push({tag:t.tags.contentSeparator,color:o?.divider}),o?.comment&&a.push({tag:t.tags.comment,color:o?.comment}),o?.meta&&a.push({tag:t.tags.meta,color:o?.meta}),o?.keyword&&a.push({tag:t.tags.keyword,color:o?.keyword}),o?.atom&&a.push({tag:[t.tags.atom,t.tags.bool],color:o?.atom}),o?.literal&&a.push({tag:[t.tags.literal,t.tags.inserted],color:o?.literal}),o?.string&&a.push({tag:[t.tags.string,t.tags.deleted],color:o?.string}),o?.special&&a.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:o?.special}),o?.variable&&a.push({tag:t.tags.definition(t.tags.variableName),color:o?.variable}),o?.local&&a.push({tag:t.tags.local(t.tags.variableName),color:o?.local}),o?.type&&a.push({tag:[t.tags.typeName,t.tags.namespace],color:o?.type}),o?.class&&a.push({tag:t.tags.className,color:o?.class}),o?.macro&&a.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:o?.macro}),o?.property&&a.push({tag:t.tags.definition(t.tags.propertyName),color:o?.property}),o?.label&&a.push({tag:t.tags.labelName,color:o?.label}),o?.operator&&a.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:o?.operator}),o?.constant&&a.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:o?.constant}),o?.instruction&&a.push({tag:[t.tags.separator,t.tags.processingInstruction,t.tags.definition(t.tags.name)],color:o?.instruction}),o?.invalid&&a.push({tag:t.tags.invalid,color:o?.invalid});const l=[];return Object.keys(c).length>0&&l.push(z.EditorView.theme(c,n)),a.length>0&&l.push(T.syntaxHighlighting(T.HighlightStyle.define(a))),l}function kt(e){return{editor:{...e.lhs?.editor,...e.rhs?.editor},highlight:{...e.lhs?.highlight,...e.rhs?.highlight},allowsFallback:e.rhs?.allowsFallback??e.lhs?.allowsFallback}}const s={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule"},pt=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${s.lineGutter} {}
${s.foldGutter} {}
${s.visibleSpace} {}
${s.matchingBracket} {}
${s.activeIndicator} {}
${s.accentColor} {}
${s.syntaxMarker} {}
${s.boldText} {}
${s.italicText} {}
${s.quoteText} {}
${s.dividerColor} {}
`,X=window,Ct=X.__extractStyleRules__??(e=>e.value?.rules),vt=X.__extractHighlightSpecs__??(e=>e.value?.specs);function yt(e){const n=document.createElement("style");return n.textContent=e,document.head.appendChild(n),n}function xt(e){if(e.length===0)return[{},[]];const n=O(e);return[Object.fromEntries(n.flatMap(a=>{const r=Ct(a)?.join(`
`)??"";return Object.entries(Tt(r))})),n.flatMap(a=>vt(a)??[])]}function b(e,n,c){return e.find(a=>!!(a.tag.toString().includes(n.toString())&&a.color!==void 0))?.color??c}function $(e,n,c){for(const[a,r]of Object.entries(e))if(a.includes(n)&&(c===void 0||!a.includes(c))){const o=r.background??r.backgroundColor;if(o!==void 0)return o}}function Bt(e){const n=e.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(n===null)return;const[c,a,r]=n.slice(1,4).map(Number);return`rgba(${c}, ${a}, ${r}, 0.6)`}function Y(e){const n=r=>r!==null&&typeof r=="object";if(!n(e))return!0;const c=Object.entries(e),a=r=>r!=null;for(const[,r]of c)if(n(r)){if(!Y(r))return!1}else if(a(r))return!1;return!0}function O(e){return Array.isArray(e)?e.flatMap(O):"extension"in e?O(e.extension):[e]}function Tt(e){const n={},c=new CSSStyleSheet;c.replaceSync(e);for(const a of c.cssRules){const{style:r,selectorText:o}=a,{background:l,backgroundColor:u}=r;n[o]={},l.length>0&&(n[o].background=l),u.length>0&&(n[o].backgroundColor=u)}return n}function Mt(e){const n=e.options?.settingsKey,c=Q(J(n));e.light!==void 0&&M(!1,c)&&(i().customThemes.light=e.light),e.dark!==void 0&&M(!0,c)&&(i().customThemes.dark=e.dark),typeof k.MarkEdit.editorView=="object"&&j(k.MarkEdit.editorView)}const B=window,i=()=>B.__markeditTheming__,Z=matchMedia("(prefers-color-scheme: dark)");typeof i()!="object"&&St();function St(){B.__markeditTheming__={styleSheet:yt(pt),configurator:new ut.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},k.MarkEdit.addExtension(i().configurator.of([])),k.MarkEdit.onEditorReady(n=>j(n));const e=()=>setTimeout(()=>j(k.MarkEdit.editorView),15);Z.addEventListener("change",e),i().mainThemeName=B.config.theme,Object.defineProperty(B.config,"theme",{get(){return i().mainThemeName},set(n){i().mainThemeName=n,e()}})}function j(e){const n=Z.matches,c=n?i().customThemes.dark:i().customThemes.light,{extensions:a,colors:r}=bt(n,c?.extension,c?.colors);e.dispatch({effects:i().configurator.reconfigure(a)});const[o,l]=xt(a),u=a.length===0&&Y(r),v=r.allowsFallback??c?.extension!==void 0;i().styleSheet.disabled=u,wt(e,n,u,o,l,r,v)}function wt(e,n,c,a,r,o,l){const u=$(a,".cm-activeLine",".cm-activeLineGutter"),v=$(a,s.selectionBackground),et=$(a,s.matchingBracket),w=getComputedStyle(e.contentDOM).color,H=o.editor?.visibleSpaceColor??Bt(w),f=l?w:void 0,I=b(r,t.tags.heading,f),rt=b(r,t.tags.processingInstruction,f),at=b(r,t.tags.strong,f),ct=b(r,t.tags.emphasis,f),nt=b(r,t.tags.quote,f),st=b(r,t.tags.contentSeparator,f),it=[[s.activeIndicator,u,"background"],[s.matchingBracket,et,"background"],[s.lineGutter,w,"color"],[s.foldGutter,H,"color"],[s.visibleSpace,H,"color"],[s.accentColor,I,"color"],[s.syntaxMarker,rt,"color"],[s.boldText,at,"color"],[s.italicText,ct,"color"],[s.quoteText,nt,"color"],[s.dividerColor,st,"color"]],lt=Array.from(document.querySelectorAll("style")),y=n?i().darkOriginalRules:i().lightOriginalRules;for(const gt of lt){const N=gt.sheet?.cssRules;if(N!==void 0)for(let q=0;q<N.length;++q){const g=N[q],m=g.selectorText??"";m.includes(".cm-focused")&&m.includes(s.selectionBackground)&&(y.selectionBackground??=g.cssText,c?g.cssText=y.selectionBackground:v!==void 0&&g.style.setProperty("background",v,"important")),I!==void 0&&(m===".cm-md-header"||m===".cm-md-header:not(.cm-md-quote)")&&(y.markdownHeader??=g.cssText,c?g.cssText=y.markdownHeader:g.style.removeProperty("color"));for(const[dt,V,F]of it)m===dt&&(V===void 0?g.style.removeProperty(F):(g.style.setProperty(F,V,"important"),(m===s.matchingBracket||m===s.activeIndicator)&&g.style.setProperty("box-shadow","unset","important")))}}}const G="#2e3440",tt="#3b4252",ot="#434c5e",p="#4c566a",C="#d8dee9",Nt="#e5e9f0",qt="#eceff4",h="#8fbcbb",W="#88c0d0",$t="#81a1c1",d="#5e81ac",Pt="#bf616a",D="#d08770",P="#ebcb8b",x="#a3be8c",L="#b48ead",K="#d30102",Lt="#252a33",E=p,Et=G,_=tt,_t=p,U=C,Ot=z.EditorView.theme({"&":{color:C,backgroundColor:Et},".cm-content":{caretColor:U},".cm-cursor, .cm-dropCursor":{borderLeftColor:U},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:_t},".cm-panels":{backgroundColor:Lt,color:p},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"transparent",outline:`1px solid ${h}`},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:C,color:G},".cm-activeLine":{backgroundColor:E},".cm-selectionMatch":{backgroundColor:Nt,color:tt},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{outline:`1px solid ${h}`},"&.cm-focused .cm-matchingBracket":{backgroundColor:qt,color:ot},".cm-gutters":{backgroundColor:G,color:p,border:"none"},".cm-activeLineGutter":{backgroundColor:E,color:C},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:_},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:_,borderBottomColor:_},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:E,color:p}}},{dark:!0}),jt=T.HighlightStyle.define([{tag:t.tags.keyword,color:d},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.propertyName,t.tags.macroName],color:W},{tag:[t.tags.variableName],color:h},{tag:[t.tags.function(t.tags.variableName)],color:h},{tag:[t.tags.labelName],color:$t},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:d},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:x},{tag:[t.tags.brace],color:h},{tag:[t.tags.annotation],color:K},{tag:[t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:L},{tag:[t.tags.typeName,t.tags.className],color:P},{tag:[t.tags.operator,t.tags.operatorKeyword],color:x},{tag:[t.tags.tagName],color:L},{tag:[t.tags.squareBracket],color:Pt},{tag:[t.tags.angleBracket],color:D},{tag:[t.tags.attributeName],color:P},{tag:[t.tags.regexp],color:d},{tag:[t.tags.quote],color:L},{tag:[t.tags.string],color:x},{tag:t.tags.link,color:x,textDecoration:"underline",textUnderlinePosition:"under"},{tag:[t.tags.url,t.tags.escape,t.tags.special(t.tags.string)],color:h},{tag:[t.tags.meta],color:W},{tag:[t.tags.monospace],color:C,fontStyle:"italic"},{tag:[t.tags.comment],color:p,fontStyle:"italic"},{tag:t.tags.strong,fontWeight:"bold",color:d},{tag:t.tags.emphasis,fontStyle:"italic",color:d},{tag:t.tags.strikethrough,textDecoration:"line-through"},{tag:t.tags.heading,fontWeight:"bold",color:d},{tag:t.tags.special(t.tags.heading1),fontWeight:"bold",color:d},{tag:t.tags.heading1,fontWeight:"bold",color:d},{tag:[t.tags.heading2,t.tags.heading3,t.tags.heading4],fontWeight:"bold",color:d},{tag:[t.tags.heading5,t.tags.heading6],color:d},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:D},{tag:[t.tags.processingInstruction,t.tags.inserted],color:h},{tag:[t.tags.contentSeparator],color:P},{tag:t.tags.invalid,color:ot,borderBottom:`1px dotted ${K}`}]),Gt=[Ot,T.syntaxHighlighting(jt)];Mt({dark:{extension:Gt}});
